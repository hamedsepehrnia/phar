{% extends 'base.html' %}
{% load static %}

{% block title %}تماس با ما - {{ site_settings.site_name|default:"داروخانه دکتر واعظی" }}{% endblock %}

{% block extra_css %}
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
>
{% endblock %}

{% block content %}
<main class="flex-1 pb-20 lg:pb-0">
  <div class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="mb-6">
      <ol class="flex items-center gap-2 text-sm text-gray-500">
        <li><a href="{% url 'core:home' %}" class="hover:text-primary-800">خانه</a></li>
        <li>/</li>
        <li class="text-gray-800 font-semibold">تماس با ما</li>
      </ol>
    </nav>

    <h1 class="text-3xl font-bold text-gray-800 mb-8">تماس با ما</h1>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- فرم تماس -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl shadow-md p-6 lg:p-8">
          <h2 class="text-xl font-bold text-gray-800 mb-6">ارسال پیام</h2>
          
          {% if messages %}
          <div class="mb-6">
            {% for message in messages %}
            <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800{% else %}bg-red-50 text-red-800{% endif %}">
              {{ message }}
            </div>
            {% endfor %}
          </div>
          {% endif %}
          
          <form action="{% url 'core:contact' %}" method="POST" class="space-y-6">
            {% csrf_token %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">نام و نام خانوادگی</label>
                <input type="text" name="name" required
                       class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">شماره تماس</label>
                <input type="tel" name="phone" required
                       class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">ایمیل</label>
              <input type="email" name="email"
                     class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors">
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">موضوع</label>
              <select name="subject" required
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors">
                <option value="">انتخاب کنید...</option>
                <option value="order">پیگیری سفارش</option>
                <option value="product">سوال درباره محصول</option>
                <option value="complaint">شکایات و انتقادات</option>
                <option value="suggestion">پیشنهادات</option>
                <option value="other">سایر</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">پیام شما</label>
              <textarea name="message" rows="5" required
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary-600 focus:ring-2 focus:ring-primary-200 transition-colors resize-none"
                        placeholder="پیام خود را بنویسید..."></textarea>
            </div>
            
            <button type="submit" 
                    class="w-full bg-primary-600 hover:bg-primary-700 text-white py-3 rounded-lg font-semibold transition-colors">
              ارسال پیام
            </button>
          </form>
        </div>
      </div>

      <!-- اطلاعات تماس -->
      <div class="space-y-6">
        <!-- اطلاعات تماس -->
        <div class="bg-white rounded-2xl shadow-md p-6">
          <h3 class="font-bold text-gray-800 mb-6">اطلاعات تماس</h3>
          <div class="space-y-4">
            <div class="flex items-start gap-4">
              <div class="bg-primary-100 rounded-full p-3 shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-primary-600">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2" />
                </svg>
              </div>
              <div>
                <p class="font-semibold text-gray-800">تلفن تماس</p>
                <p class="text-gray-600">{{ site_settings.phone|default:"021-12345678" }}</p>
                <p class="text-sm text-gray-500">شنبه تا پنج‌شنبه ۹ الی ۱۸</p>
              </div>
            </div>
            
            <div class="flex items-start gap-4">
              <div class="bg-green-100 rounded-full p-3 shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9" /><path d="M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1" />
                </svg>
              </div>
              <div>
                <p class="font-semibold text-gray-800">واتساپ</p>
                <p class="text-gray-600">{{ site_settings.whatsapp|default:"09123456789" }}</p>
                <p class="text-sm text-gray-500">پاسخگویی سریع</p>
              </div>
            </div>
            
            <div class="flex items-start gap-4">
              <div class="bg-blue-100 rounded-full p-3 shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" /><path d="M3 7l9 6l9 -6" />
                </svg>
              </div>
              <div>
                <p class="font-semibold text-gray-800">ایمیل</p>
                <p class="text-gray-600">{{ site_settings.email|default:"info@golnaz.com" }}</p>
              </div>
            </div>
            
            <div class="flex items-start gap-4">
              <div class="bg-orange-100 rounded-full p-3 shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-orange-600">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" /><path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z" />
                </svg>
              </div>
              <div>
                <p class="font-semibold text-gray-800">آدرس</p>
                <p class="text-gray-600">{{ site_settings.address|default:"تهران، خیابان ولیعصر" }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- نقشه -->
        <div class="bg-white rounded-2xl shadow-md p-6">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-bold text-gray-800">موقعیت روی نقشه</h3>
            <span class="text-xs font-semibold text-primary-700">OpenStreetMap</span>
          </div>
          <p class="text-sm text-gray-600 mb-3">آدرس ثبت‌شده در تنظیمات روی نقشه مشخص شده است.</p>
          <div
            id="contactMap"
            class="w-full rounded-xl ring-1 ring-gray-200 overflow-hidden"
            style="height: 280px;"
            data-lat="{{ site_settings.map_latitude|default:'32.661443' }}"
            data-lng="{{ site_settings.map_longitude|default:'51.666552' }}"
            data-zoom="{{ site_settings.map_zoom|default:'14' }}"
          ></div>
        </div>
        
        <!-- شبکه‌های اجتماعی -->
        <div class="bg-white rounded-2xl shadow-md p-6">
          <h3 class="font-bold text-gray-800 mb-4">ما را دنبال کنید</h3>
          <div class="flex items-center gap-3">
            <a href="{{ site_settings.instagram|default:'#' }}" class="bg-gradient-to-r from-sky-500 to-cyan-400 text-white p-3 rounded-full hover:opacity-90 transition-opacity">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 4a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-8a4 4 0 0 1 -4 -4z" /><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M16.5 7.5l0 .01" />
              </svg>
            </a>
            <a href="{{ site_settings.telegram|default:'#' }}" class="bg-blue-500 text-white p-3 rounded-full hover:opacity-90 transition-opacity">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
              </svg>
            </a>
            <a href="{{ site_settings.whatsapp_link|default:'#' }}" class="bg-green-500 text-white p-3 rounded-full hover:opacity-90 transition-opacity">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9" /><path d="M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}

{% block extra_js %}
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mapEl = document.getElementById('contactMap');
    if (!mapEl) return;

    const lat = parseFloat(mapEl.dataset.lat || '32.661443');
    const lng = parseFloat(mapEl.dataset.lng || '51.666552');
    const zoom = parseInt(mapEl.dataset.zoom || '14', 10);

    const map = L.map(mapEl, { scrollWheelZoom: false }).setView([lat, lng], zoom);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    const markerTitle = "{{ site_settings.site_name|default:'داروخانه'|escapejs }}";
    const markerAddress = "{{ site_settings.address|default:'مکان ثبت‌شده'|escapejs }}";

    L.marker([lat, lng]).addTo(map).bindPopup(`<strong>${markerTitle}</strong><br>${markerAddress}`);
  });
</script>
{% endblock %}
